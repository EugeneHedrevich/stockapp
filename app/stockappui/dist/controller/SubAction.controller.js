sap.ui.define(["./BaseController","sap/m/MessageToast","sap/m/MessageBox"],function(t,e,o){"use strict";return t.extend("stockappui.controller.SubAction",{onInit(){this.getRouter().getRoute("RouteSubAction").attachPatternMatched(this.onRouteMatched,this);this.getView().addEventDelegate({onAfterShow:()=>this.addFunctionKeyListener?.(),onAfterHide:()=>this.removeFunctionKeyListener?.()})},pressKeyOnKeyboard(t){switch(t){case"F7":case"Escape":this.onNavBack();break;case"F4":{const t=this.getOwnerComponent().getModel("vm");if(t.getProperty("/__sub/mode")==="TopHU")this.onSaveTopHU();break}}},async onRouteMatched(t){const{mode:e}=t.getParameter("arguments");const o=this.getOwnerComponent().getModel("vm");o.setProperty("/__sub/mode",e);if(e==="List"){await this._loadBinList(o.getProperty("/warehouse"),o.getProperty("/bin"))}},onNavBack(){const t=this.getOwnerComponent().getModel("vm");this.getRouter().navTo("RouteStockEntry",{warehouse:encodeURIComponent(t.getProperty("/warehouse")||""),bin:encodeURIComponent(t.getProperty("/bin")||"")})},onSaveTopHU:async function(){const t=this.getOwnerComponent().getModel("vm");const n=(t.getProperty("/__sub/topHu")||"").trim();const r=(t.getProperty("/__sub/packMat")||"").trim();if(!n){o.error(this.getI18nText("scanTopHU"));return}const s={warehouse:t.getProperty("/warehouse"),storageBin:t.getProperty("/bin"),topHU:n,packMat:r};try{this.showBusyIndicator();const o=await this.callAction("ConfirmTopHU",{input:s});t.setProperty("/__sub/topHu",o?.topHU||n);e.show(this.getI18nText("msgSaved"));this.onNavBack()}catch(t){this.showActionError(t,"ConfirmTopHU failed")}finally{this.hideBusyIndicator()}},onAddSerial:function(t){const e=this.getOwnerComponent().getModel("vm");const n=t.getSource();const r=(n.getValue()||"").trim().toUpperCase();n.setValue("");if(!r)return;if(!/^\d+$/.test(r)){o.error(this.getI18nText("errQtyNumeric"));return}let s=e.getProperty("/serials")||[];if(s.includes(r)){o.error(this.getI18nText("errDuplicateSerial"))}else{s.push(r);e.setProperty("/serials",s);e.setProperty("/entry/quantity",s.length)}},async _loadBinList(t,e){const o=this.getOwnerComponent().getModel();const n=o.bindContext("/ExportBin(...)");n.setParameter("warehouse",t);n.setParameter("storageBin",e);await n.execute();const r=n.getBoundContext().getObject();this.getOwnerComponent().getModel("vm").setProperty("/list",r?.value||[])},onBackToEntry(){this.onNavBack()}})});
//# sourceMappingURL=SubAction.controller.js.map