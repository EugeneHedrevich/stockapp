sap.ui.define(["./BaseController","sap/m/MessageToast","sap/m/MessageBox"],function(t,e,o){"use strict";return t.extend("stockappui.controller.SubAction",{onInit(){this.initBackButtonRouting("RouteSubAction");this.getRouter().getRoute("RouteSubAction").attachPatternMatched(this.onRouteMatched,this);this.getView().addEventDelegate({onAfterShow:()=>this.addFunctionKeyListener?.(),onAfterHide:()=>this.removeFunctionKeyListener?.()})},async onRouteMatched(t){const{mode:e}=t.getParameter("arguments");const o=this.getModelMain();o.setProperty("/__sub/mode",e);if(e==="List"){await this._loadBinList(o.getProperty("/warehouse"),o.getProperty("/bin"))}},pressKeyOnKeyboard(t){switch(t){case"F7":this.onBackUp();break;case"Escape":this.onNavBack();break;case"F4":{const t=this.getModelMain();if(t.getProperty("/__sub/mode")==="TopHU")this.onConfirmTopHu();break}}},onNavBack(){const t=this.getModelMain();this.getRouter().navTo("RouteStockEntry",{warehouse:encodeURIComponent(t.getProperty("/warehouse")||""),bin:encodeURIComponent(t.getProperty("/bin")||"")})},onConfirmTopHu:async function(){const t=this.getModelMain();const n=(t.getProperty("/__sub/topHu")||"").trim();const s=(t.getProperty("/__sub/packMatTopHu")||"").trim();if(!n){o.error(this.getI18nText("scanTopHU"));return}const r={warehouse:t.getProperty("/warehouse"),storageBin:t.getProperty("/bin"),topHU:n,packMatTopHU:s};try{this.showBusyIndicator();const o=await this.callAction("ConfirmTopHU",{input:r});t.setProperty("/__sub/topHu",o?.topHU||n);e.show(this.getI18nText("msgSaved"));this.onNavBack()}catch(t){this.showActionError(t,"ConfirmTopHU failed")}finally{this.hideBusyIndicator()}},onAddSerial:function(t){const e=this.getModelMain();const n=t.getSource();const s=(n.getValue()||"").trim().toUpperCase();n.setValue("");if(!s)return;if(!/^\d+$/.test(s)){o.error(this.getI18nText("errQtyNumeric"));return}let r=e.getProperty("/serials")||[];if(r.includes(s)){o.error(this.getI18nText("errDuplicateSerial"))}else{r.push(s);e.setProperty("/serials",r);e.setProperty("/entry/quantity",r.length)}},async _loadBinList(t,e){const o=this.getOwnerComponent().getModel();const n=o.bindContext("/ExportBin(...)");n.setParameter("warehouse",t);n.setParameter("storageBin",e);await n.execute();const s=n.getBoundContext().getObject();this.getModelMain().setProperty("/list",s?.value||[])}})});
//# sourceMappingURL=SubAction.controller.js.map