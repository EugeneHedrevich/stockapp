sap.ui.define(["./BaseController","sap/ui/core/routing/History","sap/m/MessageToast","sap/m/MessageBox"],function(t,e,o,n){"use strict";const r=t=>t===undefined||t===null||String(t).trim()==="";return t.extend("stockappui.controller.StockEntry",{onInit(){this.initBackButtonRouting("RouteStockEntry");this.getView().addEventDelegate({onAfterShow:()=>this.addFunctionKeyListener?.(),onAfterHide:()=>this.removeFunctionKeyListener?.()})},pressKeyOnKeyboard(t){switch(t){case"Enter":case"F4":this.onConfirm();break;case"F1":this.onOpenTopHU();break;case"F2":this.onOpenSerNb();break;case"F6":this.onOpenList();break;case"F7":this.onBackUp();break;case"Escape":this.onNavBack();break}},onNavBack(){const t=e.getInstance();if(t.getPreviousHash()!==undefined)return window.history.go(-1);const o=this.getOwnerComponent().getModel("vm");this.getRouter().navTo("RouteStorageBin",{warehouse:encodeURIComponent(o.getProperty("/warehouse")||"")})},onOpenTopHU(){const t=this.getModelMain();this.getRouter().navTo("RouteSubAction",{mode:"TopHU",warehouse:encodeURIComponent(t.getProperty("/warehouse")||""),bin:encodeURIComponent(t.getProperty("/bin")||"")})},onOpenSerNb(){const t=this.getModelMain();this.getRouter().navTo("RouteSubAction",{mode:"SerNb",warehouse:encodeURIComponent(t.getProperty("/warehouse")||""),bin:encodeURIComponent(t.getProperty("/bin")||"")})},onOpenList(){const t=this.getModelMain();this.getRouter().navTo("RouteSubAction",{mode:"List",warehouse:encodeURIComponent(t.getProperty("/warehouse")||""),bin:encodeURIComponent(t.getProperty("/bin")||"")})},onConfirm:async function(){const t=this.getModelMain();const e=t.getProperty("/entry")||{};const s=t.getProperty("/serials")||[];const i=!r(e.product);const a=!r(e.quantity);const u=!r(e.hu);if(!u&&!i&&!a){n.error(this.getI18nText("errConfirmMinReq"));return}if(i&&!a){n.error(this.getI18nText("errProductNeedsQty"));return}if(a&&isNaN(Number(e.quantity))){n.error(this.getI18nText("errQtyNumeric"));return}if(!i&&a){n.error(this.getI18nText("errQtyNoProduct"));return}const c=t.getProperty("/warehouse");const p=t.getProperty("/bin");const h={warehouse:c,storageBin:p,topHU:t.getProperty("/__sub/topHu")||null,packMatTopHU:t.getProperty("/__sub/packMatTopHu")||null,stockHU:e.hu||null,packMatStockHU:e.packMat||null,product:e.product||null,batch:e.batch||null,quantity:a?Number(e.quantity):null,uom:e.uom||null};try{this.showBusyIndicator();let e;if(s.length>0){e=await this.callAction("ConfirmStockWithSerials",{entry:h,serials:s})}else{e=await this.callAction("ConfirmStock",{entry:h})}t.setProperty("/hostPhysicalStockId",e?.id||e?.ID||null);t.setProperty("/entry/quantity",e?.quantity??null);t.setProperty("/serials",[]);o.show(this.getI18nText("msgConfirmSuccess"));t.setProperty("/entry",{hu:"",packMat:"",product:"",batch:"",quantity:null,uom:""});t.setProperty("/__sub/topHu","");t.setProperty("/__sub/packMatTopHu","")}catch(t){this.showActionError(t,"Confirm failed")}finally{this.hideBusyIndicator()}},onLiveChange(){}})});
//# sourceMappingURL=StockEntry.controller.js.map